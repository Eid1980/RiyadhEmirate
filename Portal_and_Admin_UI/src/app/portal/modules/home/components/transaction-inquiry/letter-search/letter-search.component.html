
<!-- search -->
<div class="py-5" *ngIf="!lettersAdvancedSearch">
  <div class="d-flex align-items-end justify-content-center flex-wrap">
    <div class="my-1">
      <label class="fa-16 text-muted mb-2 fw-normal" for="letterNumber">
        <span>رقم الخطاب</span>
        <small class="text-primary-alt-3 me-2">(البحث: الجهات: كل الجهات , المجال: عام , السنة: {{currentYear}})</small>
      </label>
      <input type="text" autocomplete="off" class="form-control mw-300 input-lg py-3" placeholder="ادخل رقم الخطاب" [(ngModel)]="letterNumber" />
    </div>

    <div class="d-flex align-items-center me-sm-5 my-1">
      <button class="btn btn-primary-2 text-white px-5" type="button" style="font-size: 16px !important; height: 55px;" (click)="lettersSearchClick()"> بحث </button>
      <button class="btn btn-primary-alt-3 me-3" type="button" style="font-size: 16px !important; height: 55px;" (click)="showLettersAdvancedSearch()">
        <i class="fa-solid fa-filter ms-3"></i>
        <span>بحث متقدم</span>
      </button>
    </div>
  </div>
</div>

<!-- advanced search -->
<div class="mx-3 pt-4" *ngIf="lettersAdvancedSearch">
  <div class="row">
    <div class="col-lg-8 col-md-10 mx-auto">
      <form [formGroup]="lettersAdvancedSearchForm" (ngSubmit)="onLettersAdvancedSearchSubmit()">
        <div class="row">
          <div class="col-sm-8 mb-6">
            <div>
              <label class="fa-14 fw-bold mb-2" for="">الجهه الرئيسية</label>
              <select class="form-select" formControlName="externalEntity" (change)="onExternalEntityChange()">
                <option value="-1" selected>-- جميع الجهات --</option>
                <option *ngFor="let external of externalEntities" [ngValue]="external.id">{{ external.name }}</option>
              </select>
            </div>
          </div>
        </div>
        <div class="row" *ngIf="lettersAdvancedSearchsubExternalEntity">
          <div class="col-sm-8 mb-6">
            <div>
              <label class="fa-14 fw-bold mb-2" for="">الجهه الفرعية</label>
              <select class="form-select" formControlName="subExternalEntity" (change)="onSubExternalEntityChange()">
                <option value="-1" selected>-- جميع الجهات --</option>
                <option *ngFor="let subExternal of subExternalEntities" [ngValue]="subExternal.id">{{ subExternal.name }}</option>
              </select>
            </div>
          </div>
        </div>
        <div class="row" *ngIf="lettersAdvancedSearchsubSubExternalEntity">
          <div class="col-sm-8 mb-6">
            <div>
              <label class="fa-14 fw-bold mb-2" for="">الجهه الفرعية</label>
              <select class="form-select" formControlName="subSubExternalEntity">
                <option value="-1" selected>-- جميع الجهات --</option>
                <option *ngFor="let subSubExternal of subSubExternalEntities" [ngValue]="subSubExternal.id">{{ subSubExternal.name }}</option>
              </select>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-4 col-sm-6 mb-4">
            <div>
              <label class="fa-14 fw-bold mb-2" for="">رقم الخطاب<span class="danger">*</span></label>
              <input type="text" class="form-control" autocomplete="off" formControlName="letterNo" id="letterNo" />
              <small *ngIf="(isFormSubmitted || lettersAdvancedSearchForm.get('letterNo').touched) && lettersAdvancedSearchForm.get('letterNo').errors?.required" class="danger">هذاالحقل مطلوب</small>
            </div>
          </div>
          <div class="col-lg-4 col-sm-6 offset-lg-2 mb-4">
            <div>
              <label class="fa-14 fw-bold mb-2" for="">السنه</label>
              <select class="form-select" name="">
                <option *ngFor="let year of years" [ngValue]="year.id">{{ year.name }}</option>
              </select>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-12 mb-4">
            <div>
              <label class="fa-14 d-block fw-bold mb-2">مجال البحث</label>
              <div class="mt-3">
                <div class="form-check form-check-inline ms-3">
                  <input class="form-check-input" type="radio" formControlName="searchClass" id="option1" value="1">
                  <label class="form-check-label fw-normal text-black fa-14" for="option1"> عام </label>
                </div>
                <div class="form-check form-check-inline ms-3">
                  <input class="form-check-input" type="radio" formControlName="searchClass" id="Option2" value="2">
                  <label class="form-check-label fw-normal text-black fa-14" for="Option2"> عرائض </label>
                </div>
                <div class="form-check form-check-inline ms-3">
                  <input class="form-check-input" type="radio" formControlName="searchClass" id="Option4" value="4">
                  <label class="form-check-label fw-normal text-black fa-14" for="Option4"> برقى </label>
                </div>
                <div class="form-check form-check-inline ms-3">
                  <input class="form-check-input" type="radio" formControlName="searchClass" id="Option5" value="5">
                  <label class="form-check-label fw-normal text-black fa-14" for="Option5"> المكتب الخاص </label>
                </div>
                <div class="form-check form-check-inline ms-3">
                  <input class="form-check-input" type="radio" formControlName="searchClass" id="Option8" value="8">
                  <label class="form-check-label fw-normal text-black fa-14" for="Option8"> استقبال جمهور </label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="row mt-3">
          <div class="col-12 d-flex justify-content-center">
            <button type="submit" class="btn btn-primary px-5">بحث</button>
            <button type="button" class="btn btn-primary-alt-3 me-3" (click)="showLettersSearch()">البحث برقم الخطاب</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- result -->
<div class="border-top mx-3 pt-4" *ngIf="lettersSearchResult">
  <div class="row">
    <div class="col-lg-8 col-md-10 mx-auto">
      <div class="table-responsive">
        <p-table #letterAdvancedSearch [value]="letterAdvancedSearchResponse" [rowHover]="true"
                 [scrollable]="true" [lazy]="true" dataKey="id" [autoLayout]="true" [responsive]="true" class="w-100">
          <ng-template pTemplate="header" let-columns>
            <tr>
              <th>م</th>
              <th>رقم الخطاب</th>
              <th>تاريخ الخطاب</th>
              <th>الجهة الوارد مها</th>
              <th>الإجراءات</th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-i="rowIndex" let-letterAdvanced>
            <tr>
              <td>{{ i + 1 }}</td>
              <td>{{ letterAdvanced.letterNo }}</td>
              <td>{{ letterAdvanced.letterDate }}</td>
              <td>{{ letterAdvanced.externalEntity }}</td>
              <td>
                <a class="btn btn-primary mx-1 p-2" title="عرض المعاملة">
                  <i class="fa fa-eye"></i>
                </a>
              </td>
            </tr>
          </ng-template>

          <ng-template pTemplate="emptymessage" let-columns>
            <tr>
              <td colspan="7" class="empty-grid-table">لا يوجد بيانات</td>
            </tr>
          </ng-template>
        </p-table>
        <!--<div class="d-flex align-items-center justify-content-between mb-4">
          <h5 class="fw-bold mb-0">الإستعلام عن الخطابات</h5>
          <button type="button" class="border-primary-2 btn btn-white my-1 px-3 py-2">
            <img src="assets/images/icons/print.svg" alt="icon" class="img-fluid ms-2" style="width: 16px;">
            <span class="fa-12">طباعة</span>
          </button>
        </div>
        <table class="table table-bordered">
          <tbody>
            <tr>
              <td class="title bg-opacity-10 bg-primary fw-bold border">رقم الوارد</td>
              <td class="content border">103</td>
            </tr>
            <tr>
              <td class="title bg-opacity-10 bg-primary fw-bold">تاريخ الوارد</td>
              <td class="content">22/2/2022</td>
            </tr>
            <tr>
              <td class="title bg-opacity-10 bg-primary fw-bold">رقم الصادر</td>
              <td class="content">103</td>
            </tr>
            <tr>
              <td class="title bg-opacity-10 bg-primary fw-bold">تاريخ الصادر</td>
              <td class="content">25/5/1995</td>
            </tr>
            <tr>
              <td class="title bg-opacity-10 bg-primary fw-bold">حالة المعاملة</td>
              <td class="content">صدرت</td>
            </tr>
            <tr>
              <td class="title bg-opacity-10 bg-primary fw-bold">الجهة الصادر إليها</td>
              <td class="content">إدارة تنفيذ الاحكام</td>
            </tr>
          </tbody>
        </table>-->
      </div>
    </div>
  </div>
</div>
